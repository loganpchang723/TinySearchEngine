#!/bin/bash

# we assume the data from the crawler is already written to the "../data" directory


#testing with missing and extra arguments
./indexer ../data/letters-0
ERROR: usage: indexer pageDirectory indexFileName

./indexer 
ERROR: usage: indexer pageDirectory indexFileName

./indexer ../data/letters-0 ../data/letters-0-index ../data
ERROR: usage: indexer pageDirectory indexFileName

#testing with wrong directory path
./indexer ../data/fakedir ../data/letters-0-index
ERROR: pageDir was not produced by crawler

#testing with wrong index file to write to
./indexer ../data/letters-0 ../dta/letters-0-index
ERROR: index file cannot be opened

#testing with a directory not created by the crawler
./indexer ../data/noncrawlerdir ../data/noncrawlerdir-index
ERROR: pageDir was not produced by crawler

#testing with directory as output file
./indexer ../data/letters-0 ../dta/letters-2
ERROR: index file cannot be opened

#testing with a read-only output file
./indexer ../data/letters-0 ../data/noncrawlerdir/readonly

#testing indexer on directory letters-0,2,4
./indexer ../data/letters-0 ../data/letters-0-index
./indextest ../data/letters-0-index ../data/letters-0-index-testing
sort -o ../data/letters-0-index ../data/letters-0-index
sort -o ../data/letters-0-index-testing ../data/letters-0-index-testing
diff --brief -s ../data/letters-0-index ../data/letters-0-index-testing
Files ../data/letters-0-index and ../data/letters-0-index-testing are identical

./indexer ../data/letters-2 ../data/letters-2-index
./indextest ../data/letters-2-index ../data/letters-2-index-testing
sort -o ../data/letters-2-index ../data/letters-2-index
sort -o ../data/letters-2-index-testing ../data/letters-2-index-testing
diff --brief -s ../data/letters-2-index ../data/letters-2-index-testing
Files ../data/letters-2-index and ../data/letters-2-index-testing are identical

./indexer ../data/letters-4 ../data/letters-4-index
./indextest ../data/letters-4-index ../data/letters-4-index-testing
sort -o ../data/letters-4-index ../data/letters-4-index
sort -o ../data/letters-4-index-testing ../data/letters-4-index-testing
diff --brief -s ../data/letters-4-index ../data/letters-4-index-testing
Files ../data/letters-4-index and ../data/letters-4-index-testing are identical


#testing with toscrape depth 0, 1
./indexer ../data/toscrape-0 ../data/toscrape-0-index
./indextest ../data/toscrape-0-index ../data/toscrape-0-index-testing
sort -o ../data/toscrape-0-index ../data/toscrape-0-index
sort -o ../data/toscrape-0-index-testing ../data/toscrape-0-index-testing
diff --brief -s ../data/toscrape-0-index ../data/toscrape-0-index-testing
Files ../data/toscrape-0-index and ../data/toscrape-0-index-testing are identical

./indexer ../data/toscrape-1 ../data/toscrape-1-index
./indextest ../data/toscrape-1-index ../data/toscrape-1-index-testing
sort -o ../data/toscrape-1-index ../data/toscrape-1-index
sort -o ../data/toscrape-1-index-testing ../data/toscrape-1-index-testing
diff --brief -s ../data/toscrape-1-index ../data/toscrape-1-index-testing
Files ../data/toscrape-1-index and ../data/toscrape-1-index-testing are identical

#testing with wikipedia depth 0,1
./indexer ../data/wikipedia-0 ../data/wikipedia-0-index
./indextest ../data/wikipedia-0-index ../data/wikipedia-0-index-testing
sort -o ../data/wikipedia-0-index ../data/wikipedia-0-index
sort -o ../data/wikipedia-0-index-testing ../data/wikipedia-0-index-testing
diff --brief -s ../data/wikipedia-0-index ../data/wikipedia-0-index-testing
Files ../data/wikipedia-0-index and ../data/wikipedia-0-index-testing are identical

./indexer ../data/wikipedia-1 ../data/wikipedia-1-index
./indextest ../data/wikipedia-1-index ../data/wikipedia-1-index-testing
sort -o ../data/wikipedia-1-index ../data/wikipedia-1-index
sort -o ../data/wikipedia-1-index-testing ../data/wikipedia-1-index-testing
diff --brief -s ../data/wikipedia-1-index ../data/wikipedia-1-index-testing
Files ../data/wikipedia-1-index and ../data/wikipedia-1-index-testing are identical

#testing indexer with valgrind on letters/index.html depth 5
valgrind --leak-check=full --show-leak-kinds=all ./indexer ../data/letters-5 ../data/letters-5-index
==29131== Memcheck, a memory error detector
==29131== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==29131== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info
==29131== Command: ./indexer ../data/letters-5 ../data/letters-5-index
==29131== 
==29131== 
==29131== HEAP SUMMARY:
==29131==     in use at exit: 0 bytes in 0 blocks
==29131==   total heap usage: 1,184 allocs, 1,184 frees, 196,959 bytes allocated
==29131== 
==29131== All heap blocks were freed -- no leaks are possible
==29131== 
==29131== For counts of detected and suppressed errors, rerun with: -v
==29131== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

#testing indextest with valgrind on letters/index.html depth 5
valgrind --leak-check=full --show-leak-kinds=all ./indextest ../data/letters-5-index ../data/letters-5-index-testing
==29145== Memcheck, a memory error detector
==29145== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==29145== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info
==29145== Command: ./indextest ../data/letters-5-index ../data/letters-5-index-testing
==29145== 
==29145== 
==29145== HEAP SUMMARY:
==29145==     in use at exit: 0 bytes in 0 blocks
==29145==   total heap usage: 258 allocs, 258 frees, 22,633 bytes allocated
==29145== 
==29145== All heap blocks were freed -- no leaks are possible
==29145== 
==29145== For counts of detected and suppressed errors, rerun with: -v
==29145== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
